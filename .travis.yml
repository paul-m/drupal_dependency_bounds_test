sudo: false
language: php
php:
  - '5.5.9'
  - '5.5'
  - '5.6'
  - '7.0'
  - '7.1'
  - '7.2'

before_script:
  - git clone --branch 8.6.x https://git.drupal.org/project/drupal.git
  - cd drupal
  # Perform a Composer install. Composer update --prefer-lowest doesn't merge
  # properly with wikimedia/composer-merge-plugin unless there is already a
  # vendor/.
  - composer install --no-progress --prefer-dist

script:
  # Update with --prefer-lowest.
  - composer update --prefer-lowest --no-progress --prefer-dist
  - composer run-script drupal-phpunit-upgrade
  # Run only unit tests because they have no dependencies to set up.
  - ./vendor/bin/phpunit -c core/ --testsuite unit
  # Update.
  - composer update --no-progress --prefer-dist
  - composer run-script drupal-phpunit-upgrade
  # Re-run the tests.
  - ./vendor/bin/phpunit -c core/ --testsuite unit
